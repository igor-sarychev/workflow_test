---
name: "Main pipeline"
run-name: "Main pipfline on [${{ github.ref_name }}]"

"on":
  workflow_dispatch:
    inputs:
      config:
        description: "Configuration to deploy"
        type: environment
        default: dev
  # push: {}

jobs:
  set_vars:
    runs-on: "self-hosted"
    environment: ${{ inputs.config }}
    outputs:
      topsecret: ${{ steps.define_vars.outputs.justsecret }}
      some: ${{ steps.define_vars.outputs.some }}
    steps:
      - name: "define vars"
        id: "define_vars"
        run: |
          echo ${{ secrets.TOPSECRET }} >> /tmp/mainsecret
          echo "justsecret=${{ secrets.TOPSECRET }}" >> $GITHUB_OUTPUT
          echo "some=hohoho" >> $GITHUB_OUTPUT

  reused:
    needs: [set_vars]
    uses: ./.github/workflows/01-reused.yml
    with:
      runs-on: "self-hosted"
      config: ${{ inputs.config }}
      some: ${{ needs.set_vars.outputs.some }}
    secrets:
      justsecret: ${{ needs.set_vars.outputs.some }}
